<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Profile - YumRush</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--brand:#22c55e;--brand2:#06b6d4;--radius:18px}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1224,#0f172a);color:var(--text);font-family:Inter,system-ui,sans-serif;padding:20px}
    a{color:inherit;text-decoration:none}
    
    .container{max-width:600px;margin:0 auto}
    
    header{display:flex;align-items:center;gap:12px;margin-bottom:24px;padding-bottom:12px;border-bottom:1px solid rgba(148,163,184,.15)}
    .back-btn{background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
    
    .profile-card{background:#0b1224;border:1px solid rgba(148,163,184,.15);border-radius:var(--radius);padding:24px;text-align:center}
    
    .profile-pic{width:140px;height:140px;border-radius:50%;background:#081022;margin:0 auto 16px;overflow:hidden;border:4px solid var(--brand);display:grid;place-items:center}
    .profile-pic img{width:100%;height:100%;object-fit:cover}
    .profile-pic span{color:var(--muted);font-size:3rem}
    
    .change-pic-btn{background:var(--brand);color:#04150f;border:none;padding:10px 16px;border-radius:8px;font-weight:700;cursor:pointer;margin-bottom:20px}
    .change-pic-btn:hover{background:#1ea853}
    
    input[type="file"]{display:none}
    
    .info-section{text-align:left;margin-top:20px}
    .info-row{margin:14px 0;padding:10px;background:#081022;border-radius:8px}
    .info-label{font-size:0.9rem;color:var(--muted)}.info-value{font-weight:700;margin-top:4px}
    
    .orders-section{margin-top:32px}
    .orders-section h2{font-size:1.3rem;margin-bottom:16px}
    .order-card{background:#081022;border:1px solid rgba(148,163,184,.15);border-radius:12px;padding:14px;margin-bottom:12px}
    .order-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .order-id{font-weight:700}
    .order-status{font-size:0.85rem;padding:4px 8px;border-radius:6px;background:var(--brand);color:#04150f}
    .order-status.pending{background:#fbbf24;color:#000}
    .order-status.delivered{background:#22c55e;color:#fff}
    .order-items{font-size:0.9rem;color:var(--muted);margin:8px 0}
    .order-total{font-weight:700;margin-top:8px}
    .order-date{font-size:0.85rem;color:var(--muted)}
    
    .logout-btn{width:100%;background:#ef4444;color:#fff;border:none;padding:12px;border-radius:8px;font-weight:700;cursor:pointer;margin-top:24px}
    .logout-btn:hover{background:#dc2626}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <button class="back-btn" onclick="window.history.back()">‚Üê</button>
      <h1 style="margin:0;flex:1">My Profile</h1>
    </header>

    <div class="profile-card">
      <div class="profile-pic" id="profilePic">
        <span>üë§</span>
      </div>
      <button class="change-pic-btn" onclick="document.getElementById('profileInput').click()">Change Profile Picture</button>
      <input type="file" id="profileInput" accept="image/*">

      <div class="info-section">
        <div class="info-row">
          <div class="info-label">Name</div>
          <div class="info-value" id="userName">‚Äî</div>
        </div>
        <div class="info-row">
          <div class="info-label">Email</div>
          <div class="info-value" id="userEmail">‚Äî</div>
        </div>
        <div class="info-row">
          <div class="info-label">Phone</div>
          <div class="info-value" id="userPhone">‚Äî</div>
        </div>
        <div class="info-row">
          <div class="info-label">Address</div>
          <div class="info-value" id="userAddress">‚Äî</div>
        </div>
      </div>
    </div>

    <div class="orders-section">
      <h2>Your Orders</h2>
      <div id="ordersList"></div>
    </div>

    <button class="logout-btn" onclick="logoutUser()">Logout</button>
  </div>

  <script>
    const currentUserEmail = localStorage.getItem('fdCurrentUser');
    const users = JSON.parse(localStorage.getItem('fdUsers') || '{}');
    const currentUser = users[currentUserEmail];

    if (!currentUserEmail || !currentUser) {
      alert('Please log in first.');
      window.location.href = 'index.html';
    }

    // Load and display profile data
    function loadProfile() {
      document.getElementById('userName').textContent = currentUser.name || '‚Äî';
      document.getElementById('userEmail').textContent = currentUser.email || '‚Äî';
      document.getElementById('userPhone').textContent = currentUser.phone || '‚Äî';
      document.getElementById('userAddress').textContent = currentUser.address || '‚Äî';

      // Load profile picture
      if (currentUser.profilePic) {
        document.getElementById('profilePic').innerHTML = `<img src="${currentUser.profilePic}">`;
      }

      // Load orders
      loadOrders();
    }

    function loadOrders() {
      const ordersList = document.getElementById('ordersList');
      const orders = currentUser.orders || [];

      if (orders.length === 0) {
        ordersList.innerHTML = '<p style="color:var(--muted);text-align:center;">No orders yet.</p>';
        return;
      }

      ordersList.innerHTML = orders.map((order, idx) => {
        const when = order.placedAt ? new Date(order.placedAt).toLocaleString() : '‚Äî';
        const itemsText = (order.items || []).map(i => `${i.qty}x ${i.name}`).join(', ');
        const statusClass = order.status === 'Delivered' ? 'delivered' : order.status === 'placed' ? 'pending' : 'pending';

        return `
          <div class="order-card">
            <div class="order-header">
              <div>
                <div class="order-id">Order #${idx + 1}</div>
                <div class="order-date">${when}</div>
              </div>
              <span class="order-status ${statusClass}">${order.status || 'Processing'}</span>
            </div>
            <div class="order-items">${itemsText}</div>
            <div class="order-total">Total: ‚Ç±${Number(order.total || 0).toFixed(2)}</div>
          </div>
        `;
      }).join('');
    }

    // Handle profile picture upload
    document.getElementById('profileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const dataUrl = event.target.result;
        currentUser.profilePic = dataUrl;
        users[currentUserEmail] = currentUser;
        localStorage.setItem('fdUsers', JSON.stringify(users));
        document.getElementById('profilePic').innerHTML = `<img src="${dataUrl}">`;
      };
      reader.readAsDataURL(file);
    });

    function logoutUser() {
      localStorage.removeItem('fdCurrentUser');
      window.location.href = 'index.html';
    }

    // Initial load
    loadProfile();
  </script>
</body>
</html>
